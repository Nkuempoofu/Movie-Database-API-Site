<!DOCTYPE html PUBLIC >
<html>

<head>
    <title>Aglet Movies</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="css/style.css" type="text/css" media="all" />
    <script type="text/javascript" src="js/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="js/jquery-func.js"></script>
    <!--[if IE 6]><link rel="stylesheet" href="css/ie6.css" type="text/css" media="all" /><![endif]-->
</head>

<body>
    <!-- START PAGE SOURCE -->
    <div id="shell">
        <div id="header">
            <!-- <h1 id="logo"><a href="#">Aglet Movies</a></h1> -->
            <div class="social"> <span>FOLLOW US ON:</span>
                <ul>
                    <li><a class="twitter" href="https://twitter.com/home?lang=en">twitter</a></li>
                    <li><a class="facebook" href="https://www.facebook.com/mpofunkue">facebook</a></li>
                </ul>
            </div>
            <div id="navigation">
                <ul>
                    <li><a class="active" href="#">HOME</a></li>
                    <li><a href="contactt/index.html">CONTACT</a></li>
                    <li><a href="./login/index.html">LOGIN</a></li>
                </ul>
            </div>
            <div id="sub-navigation">

                <div id="search">
                    <form action="#" method="get" accept-charset="utf-8">
                        <label for="search-field">SEARCH</label>
                        <input type="text" name="search field" value="" id="search-field" class="blink search-field" />
                        <!--<input type="submit" value="GO!" class="search-button" />-->
                        <input type="button" value="GO!" class="search-button" onclick="SearchMovies()"/>
                        
                    </form>
                </div>
            </div>
        </div>
        <div id="main">
            <div id="content">
                <div class="box">
                    <div class="head">
                        <h2>Movies</h2>
                        <p class="text-right"><a href="#">See all</a></p>
                    </div>
                    <div id="dynamic-div">

                    </div>
                    <div class="cl">&nbsp;</div>
                </div>

            </div>
    <!-- pagination -->
            <div id="listingTable"></div>
            <a href="javascript:prevPage()" id="btn_prev">Prev</a>
            <a href="" id="btn_next">Next</a>
            page: <span id="page"></span>
   <!-- End of pagination -->

            <div class="cl">&nbsp;</div>
        </div>
        <div id="footer">
            <p class="lf">Copyright &copy; 2022 <a href="https://aglet.co.za/">AGLET MOVIEDB</a> - All Rights Reserved</p>
            <p class="rf">Design by <a href="">Nkululeko Mpofu</a></p>
            <div style="clear:both;"></div>
        </div>
    </div>
    <!-- END PAGE SOURCE -->
    <script>
        
        function SearchMovies() {
            var searchText = $("#search-field").val(); 
            $('#dynamic-div').html("") ;
            api_key = "68F9B4619398DAA3C41A7D0DF1342B81"
            $.ajax({
                type: "POST",
                url: "api.php",
                data: {
                    api_key: api_key
                },
                dataType: "json", //expect json to be returned 
                success: function(response) {
                    ress = JSON.stringify(response);
                    res = JSON.parse(ress);
                    status = res['status'];
                    payload = res['arrayMovies'];

                    console.log(payload);
                    //username = res['username'];
                    var cnt = 0;
                    switch (status) {

                        case '200':
                            payload.forEach(function(details) {
                                var original_title = details['original_title'];
                                var poster_path = details['poster_path'];
                                var release_date = details['release_date'];
                                if(original_title.toLowerCase().includes(searchText.toLowerCase())){
                                

                                var button_name = "Add Favourite"

                                var row = "<div class='movie'>" +
                                    "<div class='movie-image'> <span class='play'><span id='tittle' class='name'>" + original_title + "</span></span><a href='#'><img id='image' src='https://image.tmdb.org/t/p/w500" + poster_path + "' alt='' /></a></div>" +
                                    "<div class='rating'><p>" + original_title + "</p><br><p> Released on <span id='release'>" + release_date + "</span> </p> <br>" +
                                    "<span class=''><a onclick='addFav()'>" + button_name + "</a></span></div>" +
                                    "</div>";
                                $('#dynamic-div').append(row);
                                // $('#dynamic-table').append(row1);
                                    }

                            })
                            break;
                        case '401':
                            alert(message);
                            $(".buttonVerify").html('Try Again?');
                            $(".buttonVerify").removeAttr('disabled');
                            alert(message);
                            window.location = './account_authentication.html';
                            console.log(message);
                            break;

                        default:
                            alert('An unknown error occured');
                            $(".buttonVerify").html('Try Again?');
                            $(".buttonVerify").removeAttr('disabled');
                            console.log(message);
                            break;
                    }



                }
            });

        }
        $(document).ready(function() {
            

            api_key = "68F9B4619398DAA3C41A7D0DF1342B81"
            $.ajax({
                type: "POST",
                url: "api.php",
                data: {
                    api_key: api_key
                },
                dataType: "json", //expect json to be returned 
                success: function(response) {
                    ress = JSON.stringify(response);
                    res = JSON.parse(ress);
                    status = res['status'];
                    payload = res['arrayMovies'];

                    console.log(payload);
                    //username = res['username'];

                    switch (status) {

                        case '200':
                            payload.forEach(function(details) {
                                var original_title = details['original_title'];
                                var poster_path = details['poster_path'];
                                var release_date = details['release_date'];

                                var button_name = "Add Favourite"

                                var row = "<div class='movie'>" +
                                    "<div class='movie-image'> <span class='play'><span id='tittle' class='name'>" + original_title + "</span></span><a href='#'><img id='image' src='https://image.tmdb.org/t/p/w500" + poster_path + "' alt='' /></a></div>" +
                                    "<div class='rating'><p>" + original_title + "</p><br><p> Released on <span id='release'>" + release_date + "</span> </p> <br>" +
                                    "<span class=''><a onclick='addFav()'>" + button_name + "</a></span></div>" +
                                    "</div>";
                                $('#dynamic-div').append(row);
                                // $('#dynamic-table').append(row1);

                            })
                            break;
                        case '401':
                            alert(message);
                            $(".buttonVerify").html('Try Again?');
                            $(".buttonVerify").removeAttr('disabled');
                            alert(message);
                            window.location = './account_authentication.html';
                            console.log(message);
                            break;

                        default:
                            alert('An unknown error occured');
                            $(".buttonVerify").html('Try Again?');
                            $(".buttonVerify").removeAttr('disabled');
                            console.log(message);
                            break;
                    }



                }
            });
            // $('#dynamic-table').DataTable({
            //                            "pagingType": "full_numbers"
            //                        });
            //pagination
        $(document).on('click', '#btn_next', function(){
            event.preventDefault();
        var id = 1;//$('#btn_next').attr('id');
        $.ajax({
          type: "POST",
          url: "api.php",
          data: {
            id: id,
          },
          success: function(){
            //location.reload();
          //$this.text('+ Cart');
          //alert("removed");
          }
        });
    });
        //end pagination

        });
    </script>

    <script>
        function addFav() {
            var tittle = document.getElementById('tittle').innerText;
            var image = document.getElementById("image").src;
            var release = document.getElementById('release').innerText;
            console.log('tittle == ' + tittle);
            console.log('image == ' + image);
            console.log('release == ' + release);
            api_key = "68F9B4619398DAA3C41A7D0DF1342B81"

            // alert("Are you sure!!!!!!!!!!!!!!!!!!!!")
            $.ajax({
                type: "POST",
                url: "save.php",
                data: {
                    api_key: api_key,
                    tittle: tittle,
                    image: image,
                    release: release
                },
                dataType: "json", //expect json to be returned                
                success: function(response) {
                    ress = JSON.stringify(response);
                    res = JSON.parse(ress);
                    console.log(res);
                    status = res['status'];
                    console.log(status);
                    payload = res['arrayUser'];

                    switch (status) {

                        case '0':
                            alert(message);
                            $(".buttonRegister").html('Try Again?');
                            $(".buttonRegister").removeAttr('disabled');
                            break;
                        case '200':
                            if (status == 200) {
                                window.location = './';
                            }

                            break;
                        case '404':
                            console.log("Page Not found");

                        default:
                            alert('An unknown error occured');
                            $(".buttonRegister").html('Try Again?');
                            $(".buttonRegister").removeAttr('disabled');
                            console.log(message);
                            break;
                    }



                },
                error: function(jqXHR, exception) {
                    console.error('AJAX responded with error code: ' + jqXHR.status + ' when it tried to send the email');
                    console.error(jqXHR);
                    $(".btn").html('Try Again?');
                    $(".btn").removeAttr('disabled');
                    alert('There was an error processing this request. Please try again later.');

                },
                timeout: 10000
            });


        }
    </script>
</body>

</html>